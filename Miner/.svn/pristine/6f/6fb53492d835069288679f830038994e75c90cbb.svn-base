//
//  StoreCollectionViewCell.m
//  Miner
//
//  Created by biggoldenbee on 15/1/19.
//  Copyright (c) 2015年 jim kaden. All rights reserved.
//

#import "StoreCollectionViewCell.h"

#import "GameUtility.h"
#import "PackageManager.h"

#import "GameObject.h"
#import "EquipmentConfig.h"
#import "Item.h"

@implementation Goods
/*
 DCnt = 10000;
 Hot = 0;
 Luck = 2000;
 MCnt = 50;
 MType = 2;
 SType = 0;
 Token = 62km;
 Type = 60103;
 */
-(void)setDataWithDictionary:(NSDictionary *)data{
    self.DCnt   = [[data objectForKey:@"DCnt"] integerValue];
    self.Hot    = [[data objectForKey:@"Hot"] integerValue];
    self.Luck   = [[data objectForKey:@"Luck"] integerValue];
    self.MCnt   = [[data objectForKey:@"MCnt"] integerValue];
    self.MType  = [[data objectForKey:@"MType"] integerValue];
    self.SType  = [[data objectForKey:@"SType"] integerValue];
    self.Token  = [data objectForKey:@"Token"];
    self.Type   = [[data objectForKey:@"Type"] integerValue];
}
@end

@interface StoreCollectionViewCell()
@property (nonatomic, assign) NSInteger theStoreType;
@property (nonatomic, assign) Goods *theGoods;
@end

@implementation StoreCollectionViewCell

-(id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self)
    {
        NSArray *arrayOfView = [[NSBundle mainBundle] loadNibNamed:@"StoreCollectionViewCell" owner:self options:nil];
        
        if (arrayOfView.count < 1)
        {
            return nil;
        }
        
        if (![[arrayOfView objectAtIndex:0] isKindOfClass:[StoreCollectionViewCell class]])
        {
            return nil;
        }
        
        self = [arrayOfView objectAtIndex:0];
    }
    return self;
}

- (void)awakeFromNib {
    // Initialization code
}

-(void)setDataWithObject:(Goods *)inGoods storeType:(NSInteger)storeType{
    self.theStoreType = storeType;
    self.theGoods = inGoods;
    
    // 载入icon
    if (self.theGoods.Type>60000){ // 默认大于60000是装备
        EquipmentDef* equipDef = [[EquipmentConfig share] getEquipmentDefWithKey:[NSNumber numberWithInteger:self.theGoods.Type]];

        [self.itemPropsBar setImage:[GameUtility imageNamed:[GameUtility getImageNameForBagOrSelectViewWithStar:(int)[equipDef equipStar]]]];
        [self.itemIcon setImage:[GameUtility imageNamed:[equipDef equipIcon]]];
        [self.itemPropsName setText:[equipDef equipName]];
        [self.itemPrice setText:[NSString stringWithFormat:@"%ld", (long)inGoods.MCnt]];
        
    } else {
        ItemDef* itemDef = [[ItemConfig share] getItemDefWithKey:[NSNumber numberWithInteger:self.theGoods.Type]];
        
        [self.itemPropsBar setImage:[GameUtility imageNamed:@"base_propsbar2_1.png"]];
        [self.itemIcon setImage:[GameUtility imageNamed:[itemDef itemIcon]]];
        [self.itemPropsName setText:[itemDef itemName]];
        [self.itemPrice setText:[NSString stringWithFormat:@"%ld", (long)inGoods.MCnt]];
        
    }
}


- (IBAction)onItemBuyClick:(id)sender {
    NSMutableDictionary* tempDict = [[NSMutableDictionary alloc]init];
    [tempDict setObject:[NSNumber numberWithLong:[self theStoreType]] forKey:@"Type"];
///    [tempDict setObject:[[self.theGoods Token] forKey:@"Token"]];
    [[PackageManager sharedInstance] storeBuyGoods:tempDict];

    NSLog(@"StoreCollectionViewCell:onItemBuyClick\n");
}

@end
